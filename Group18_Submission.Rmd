---
title: "Group 18 - R Bootcamp"
author: "Noel Rinke, Yanik Baumann"
date: \today
output: 
  pdf_document:
    toc: true
    toc_depth: 3
    number_sections: true
    includes:
      in_header: "wrap-code.tex"
biblio-style: apa
bibliography: Sources.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE)
```


# Introduction

Noel Rinke and Yanik Baumann are two students at the Lucerne University of Applied Sciences and Arts studying for a Master's degree in Applied Information and Data Science. Our assignment represents a complete data analysis where we use a wide variety of R functionalities. For this analysis, we use data from Citibike New York. 

## Background Information on New York's Bike-Sharing Scheme (work-in-progress)

The bike sharing system Citi Bike began operating in New York City in 2013 [@LyftInc22]. With 19000 bikes and more than 1000 stations (as of 2022), Citi Bike is the largest bike-sharing system in the United States, making it an integral part of New York City's transport network [@LyftInc22]. The bike-sharing scheme consists of a fleet of specifically engineered, long-lasting bicycles that are connected to a network of stations which span with Manhattan, Brooklyn, Queens the Bronx and Jersey City all five boroughs of New York City. Citi Bike provides an app which allows its customers to unlock bikes, see real-time station information, and personalized data such as kilometers traveled and calories burnt.

As the New York Times [-@Hu2021] reported "*traffic has come roaring back in New York City after largely disappearing at the height of the corona virus pandemic*". While cars contribute to traffic congestion, greenhouse gas emissions and global warming, bicycles offer an environmentally friendlier, healthier, more economical and less space-consuming transportation alternative.


## Aim of the Analysis

blabla


## Datasets used

The subsequent analysis required two different datasets: Citi Bike ride-sharing data and weather data.

As mentioned above, the data with records on the bicycle rides was obtained from Citi Bike which provides all datasets since the service began operating in 2013. To represent each season, four different data sets were downloaded for January, April, July, and December, and an equal sample size was drawn from each month in the data preparation section. In addition, it is important to note that the Covid 19 pandemic was thought to be a potential confounding factor, so we specifically chose to use data from 2019, which predated the pandemic.

The second dataset used stems from the National Oceanic and Atmospheric Administration which is part of the U.S. Department of Commerce. The dataset includes weather data measured at the weather station with the number GHCND:USW00094728 which corresponds to New York City's Central Park.


# Installation of Packages

```{r packages, echo=TRUE, warning=FALSE}
require(maps)
require(leaflet)
require(skimr)
require(DataExplorer)
require(st)
require(sf)
require(leaflet.extras)
require(ggeasy)
require(tidyr)
require(ggplot2)
require(ggthemes)
require(dplyr)
require(scales)
require(knitr)
require(lubridate)
require(ggmap)
require(rgdal)
require(httr)
require(broom)
```

# Data Preparation

This chapter describes how to import and prepare the data sets.


## Data Import

```{r data import, echo=TRUE, eval=FALSE, tidy=TRUE}
citibike_jan19 <- read.csv(file = file.path('C:\\Users\\noelr\\switchdrive',
'\\SharedOstSchweiz\\R Bootcamp\\Data\\201901-citibike-tripdata.csv'))

citibike_apr19 <- read.csv(file = file.path('C:\\Users\\noelr\\switchdrive',
'\\SharedOstSchweiz\\R Bootcamp\\Data\\201904-citibike-tripdata.csv'))

citibike_jul19 <- read.csv(file = file.path('C:\\Users\\noelr\\switchdrive',
'\\SharedOstSchweiz\\R Bootcamp\\Data\\201907-citibike-tripdata.csv'))

citibike_oct19 <- read.csv(file = file.path('C:\\Users\\noelr\\switchdrive',
'\\SharedOstSchweiz\\R Bootcamp\\Data\\201910-citibike-tripdata.csv'))

```

```{r data import (weather data)}
nyc_weather_2019 <- read.csv(file = file.path('C:\\Users\\noelr\\switchdrive',
'\\SharedOstSchweiz\\R Bootcamp\\Data\\New York Weather 2019.csv'))

```


## Taking Samples

```{r sample, echo=TRUE, eval=FALSE,}
citibike_jan19_sample <- sample_n(citibike_jan19, size=1000)
citibike_apr19_sample <- sample_n(citibike_apr19, size=1000)
citibike_jul19_sample <- sample_n(citibike_jul19, size=1000)
citibike_oct19_sample <- sample_n(citibike_oct19, size=1000)

```

## Adding Season to the data sets

```{r sample, echo=TRUE, eval=FALSE,}
citibike_jan19_sample <- cbind(citibike_jan19_sample, season='winter')
citibike_apr19_sample <- cbind(citibike_apr19_sample, season='spring')
citibike_jul19_sample <- cbind(citibike_jul19_sample, season='summer')
citibike_oct19_sample <- cbind(citibike_oct19_sample, season='autumn')

```

## Merging the Datasets from Citibike

```{r dataset merge, echo=TRUE, eval=FALSE,}
citibike_merged_2019 <- rbind(citibike_jan19_sample, citibike_apr19_sample, citibike_jul19_sample, citibike_oct19_sample)

```

## Adding Date-column

```{r add date column, echo=TRUE, eval=FALSE,}
citibike_merged_2019$DATE <- substr(citibike_merged$starttime, 1, 10)

```

## Cleaning the weather data set

```{r cleaning weather data, echo=TRUE, eval=FALSE,}
nyc_weather_cleaned <- subset(nyc_weather_2019, select = -c(TSUN, TAVG, AWND))

```

## Join citibike_merged_2019 and the nyc_weather_cleaned

```{r leftjoin citibike and weather, echo=TRUE, eval=FALSE,}
citi_cb <- left_join(citibike_merged, nyc_weather_cleaned, 
                                       by='DATE')
```

## Calculate average temperature
```{r calc avg temp, echo=TRUE, eval=FALSE,}
citi_cb$meantemp <- (citi_cb$TMAX + citi_cb$TMIN) / 2
```

## Grouping rain intensity
```{r grouping rain intensity, echo=TRUE, eval=FALSE,}
citi_cb$raingrouped <- ifelse(citi_cb$PRCP == 0, 'no rain',
                       ifelse(citi_cb$PRCP > 0   & citi_cb$PRCP <=2.0, 'weak',
                       ifelse(citi_cb$PRCP >2.0  & citi_cb$PRCP <=10.0, 'moderate',
                       ifelse(citi_cb$PRCP >10.0 & citi_cb$PRCP <=30.0, 'heavy', 'intense'))))
```

## Snow Yes/No
```{r snow yes/no, echo=TRUE, eval=FALSE,}
citi_cb$Snow_yesno <- ifelse(citi_cb$SNOW > 0, 'yes', 'no')
```

## Getting the weekdays
```{r getting the weekdays, echo=TRUE, eval=FALSE,}
# Weekdays in english
Sys.setlocale("LC_TIME", "English")

# Define Weekday
citi_cb$weekday <- weekdays(as.Date(citi_cb$DATE))

# Setting correct factor order
citi_cb$weekday <- factor(citi_cb$weekday,levels = c("Monday","Tuesday","Wednesday",
                                                     "Thursday","Friday","Saturday","Sunday"))
```

## Getting Time and Daytimes
```{r Getting Time and Daytimes, echo=TRUE, eval=FALSE,}
citi_cb$onlytime <- as.POSIXct(substr(citi_cb$starttime, 12, 19), format="%H:%M:%S")

# Only Hours and Minutes
citi_cb$time     <- strftime(citi_cb$onlytime,format="%H:%M")

# Only Hour
citi_cb$hour     <- as.numeric(substr(citi_cb$time,1,2))

# Set Daytime
citi_cb$daytime  <- ifelse(citi_cb$onlytime <= as.POSIXct("06:00:00",format="%H:%M:%S"), 'night',
                    ifelse(citi_cb$onlytime > as.POSIXct("06:00:00",format="%H:%M:%S") & 
                    citi_cb$onlytime <= as.POSIXct("12:00:00",format="%H:%M:%S"), 'morning',
                    ifelse(citi_cb$onlytime > as.POSIXct("12:00:00",format="%H:%M:%S") & 
                    citi_cb$onlytime <= as.POSIXct("18:00:00",format="%H:%M:%S"), 'afternoon', 
                    ifelse(citi_cb$onlytime > as.POSIXct("18:00:00",format="%H:%M:%S") & 
                    citi_cb$onlytime <= as.POSIXct("24:00:00",format="%H:%M:%S"), 'evening', 'night'))))

# Setting correct factor order
citi_cb$daytime <- factor(citi_cb$daytime,levels = c("morning","afternoon","evening","night"))
```

## Setting trip duration groups
```{r grouping trip duration, echo=TRUE, eval=FALSE,}
citi_cb$tripduration_cat <- ifelse(citi_cb$tripduration <=300, '0 to 5 min',
                            ifelse(citi_cb$tripduration >300 & citi_cb$tripduration <=900, '5 to 15 min',
                            ifelse(citi_cb$tripduration >900 & citi_cb$tripduration <=1800, '15 to 30 min',
                            ifelse(citi_cb$tripduration >1800 &
                                   citi_cb$tripduration <=3600, '30 to 60 min','over 60 min'))))
```

# Analysis



## Data Inspection
```{r data inspectation, echo=TRUE, eval=FALSE,}
# First and last 5 observations
head(citi_cb)
tail(citi_cb)

# Dimensions of the data set (number of rows and columns)
dim(citi_cb)

# Variables of the data set
names(citi_cb)

# Summary of the data set
summary(citi_cb)

# Alternative to summary to get an overview of the data frame
skim(citi_cb)

# Interesting function (creates an HTML report)
create_report(citi_cb)

# Ranking of the most to least popular stations

citi_cb %>% group_by(start.station.name) %>% summarize(count=n())
```

## Frequencies


## Density Map: Identifiying the most and least popular Districts


## Influence of Meteorological Factors


### Influence of Temperature


### Influence of Precipitation


### Influence of Snowfall and Snow Depth



# Results



# Sources


